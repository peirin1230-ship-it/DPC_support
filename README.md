# DPC検索ツール — 仕様書・利用ガイド

令和6年度 DPC電子点数表に基づくDPCコード検索・コーディング支援ツールです。

**公開URL**: https://peirin1230-ship-it.github.io/DPC_support/

---

## 目次

1. [概要](#概要)
2. [検索機能](#検索機能)
3. [検索結果の見方](#検索結果の見方)
4. [他に評価される項目（ドリルダウン）](#他に評価される項目ドリルダウン)
5. [詳細モーダル](#詳細モーダル)
6. [点数推移グラフ](#点数推移グラフ)
7. [DPC比較機能](#dpc比較機能)
8. [お気に入り・検索履歴](#お気に入り検索履歴)
9. [同一MDC内の類似分類比較](#同一mdc内の類似分類比較)
10. [ICD-10一覧](#icd-10一覧)
11. [ソート・フィルタ](#ソートフィルタ)
12. [DPCコーディングの基本的な流れ](#dpcコーディングの基本的な流れ)
13. [用語集](#用語集)
14. [開発者向け情報](#開発者向け情報)

---

## 概要

DPC（診断群分類）は、入院患者の診断・手術・処置等の組み合わせによって決まる包括評価の分類です。本ツールは、疾患名・手術・処置・薬剤などの条件からDPCコードを素早く検索し、正しいコーディングを支援します。

### 主な特徴

- 疾患名、ICD-10コード、Kコード（手術）、処置コード、薬剤名による横断検索
- 全ての分岐パターンのDPCを一覧表示
- 処置等の優先度に基づくドリルダウン絞り込み
- 複数DPCの点数比較（比較チャート付き）
- 入院日数に応じた総点数の自動計算
- 出来高算定手術の自動判定
- 点数推移グラフによる期間別点数の視覚化
- お気に入り・検索履歴の保存
- 同一MDC内の類似分類比較

---

## 検索機能

画面上部の4つの検索欄から、いずれか1つ以上の条件を入力して検索します。

### 検索欄一覧

| 検索欄 | 入力内容 | 入力例 |
|--------|----------|--------|
| **疾患名 / ICD-10** | 病名の一部またはICD-10コード | `肺炎`、`I510`、`心不全` |
| **手術 Kコード** | 手術のKコード、または手術名の一部 | `K549`、`腹腔鏡` |
| **手術・処置等** | 処置等1・処置等2のコード、または名称 | `SPECT`、`E101`、`DD01` |
| **薬剤検索** | 薬剤の一般名・商品名の一部、または薬剤コード | `リコモジュリン`、`ヘパリン` |

### 検索の仕組み

- 各欄に文字を入力すると、候補がドロップダウンで表示されます（オートコンプリート）
- 候補をクリックして選択し、「検索」ボタンを押します
- 複数の欄を組み合わせて絞り込むことも可能です
  - 例: 「疾患名: 心不全」+「手術: K552」→ 心不全の分類かつK552関連のDPCのみ表示
- 「クリア」ボタンで全ての検索条件と結果をリセットします
- 検索を実行すると、自動的に検索履歴に保存されます

### 出来高算定手術の警告

包括評価の対象外となる手術（出来高算定手術）を選択した場合、画面上部に赤い警告メッセージが表示されます。該当するDPCは出来高で算定されるため、包括点数は適用されません。

---

## 検索結果の見方

検索を実行すると、条件に合致する分類（診断群分類番号とその手術区分）に属する**全ての分岐パターンのDPC**が一覧表示されます。

### 各DPCカードの構成

```
[★] [チェック] 050050xx9920xx  循環器系の疾患        [期間Ⅰ] [期間Ⅱ] [期間Ⅲ]
               条件: ○○  手術: なし                   3,087   2,310   1,963
               処置1: あり  処置2: なし                 5日      10日    30日
               副傷病: なし
```

| 要素 | 説明 |
|------|------|
| **★（星マーク）** | お気に入りボタン。☆をクリックで★に変わり、ブラウザに保存されます |
| **DPCコード**（青字） | 14桁のDPCコード。クリックすると詳細モーダルが開きます |
| **出来高**（赤ラベル） | 出来高算定対象のDPCに表示されます |
| **分類名** | 診断群分類の名称 |
| **条件** | 病態等分類がある場合に黄色で表示 |
| **手術 / 処置1 / 処置2 / 副傷病** | 各分岐の状態。「あり」の場合は緑色で強調表示 |
| **重症度** | 重症度分岐がある場合に黄色で表示 |
| **期間Ⅰ/Ⅱ/Ⅲ** | 各期間の1日あたりの点数と日数 |
| **総点数** | 入院日数を入力している場合に表示。該当日数での合計点数 |

### 入院日数の入力

「入院日数」欄に日数を入力すると：
- 各DPCカードに総点数が表示されます
- 期間Ⅲを超える日数がある場合は「出来高○日」と赤字で表示されます
- 総点数順でのソートが有効になります

---

## 他に評価される項目（ドリルダウン）

検索結果の上部に表示される折りたたみパネルです。検索で見つかったDPCに対して、**コーディングに影響する処置等の項目**を一覧表示します。

### 基本動作

1. **初期状態**: 全ての処置等1・処置等2の項目が表示されます
2. **項目を選択**: クリックすると、その項目に対応するDPCに絞り込まれます
3. **優先度フィルタ**: 選択した項目よりも**コードの優先度が高い項目のみ**が引き続き表示されます

### 優先度（corrVal）の仕組み

DPCの処置等分岐には**優先度**が設定されています。数値が大きいほど優先度が高く、複数の処置等に該当する場合は最も優先度の高いものが適用されます。

**例: 050050（循環器系）の処置等2**

| 優先度 | コード例 | 処置名 |
|--------|----------|--------|
| 1（低） | G005 | 中心静脈注射 |
| 2（中） | J0384 | 人工腎臓 |
| 3（高） | 0022 | SPECT |

- 初期状態: G005、J0384、0022 の全てが表示
- G005を選択 → J0384、0022（優先度 > 1）が表示
- J0384を選択 → 0022（優先度 > 2）のみ表示
- 0022を選択 → これ以上の優先度がないため「これ以上評価される項目はありません」と表示

### 選択状態の表示

選択中の項目は緑色のバーで表示されます：

```
選択中 処置等1: DD01  血管内超音波検査等加算等
選択中 処置等2: J0384  人工腎臓
```

「選択をクリア」ボタンで全ての選択を解除し、全DPCの表示に戻ります。

---

## 詳細モーダル

DPCコード（青字のリンク）をクリックすると、そのDPCの詳細情報がモーダルウィンドウで表示されます。

### 表示内容

| セクション | 内容 |
|------------|------|
| **DPCコード** | 14桁のコードと出来高ラベル |
| **分類名** | 診断群分類の名称 |
| **条件** | 病態等分類（該当する場合） |
| **点数情報** | 期間Ⅰ/Ⅱ/Ⅲの点数・日数。入院日数入力時は総点数も表示 |
| **点数推移グラフボタン** | クリックで点数推移グラフを表示（出来高DPCでは非表示） |
| **分岐情報** | 手術、処置等1、処置等2、定義副傷病の状態 |
| **副傷病 対象ICD** | 定義副傷病が「あり」の場合、対象となるICD-10コードの一覧 |
| **重症度分岐** | 重症度等の分岐定義。現在のDPCに該当する値が黄色で強調 |

### 折りたたみセクション

以下の情報は「▸」をクリックして展開できます：

- **対象ICD-10**: この分類に含まれるICD-10コードの一覧
- **手術定義**: 手術区分ごとのKコード一覧（実際にDPCが存在する区分のみ表示）
- **処置等1定義**: 処置等1の区分ごとのコード一覧
- **処置等2定義**: 処置等2の区分ごとのコード一覧（薬剤は商品名も表示）
- **同一MDC内の類似分類**: 同じMDCに属する他の分類の一覧（[詳細](#同一mdc内の類似分類比較)）

各定義セクションでは、現在のDPCに該当する区分が**黄色**で強調表示されます。

---

## 点数推移グラフ

詳細モーダル内の「点数推移グラフ」ボタンをクリックすると、入院日数に応じた点数の変化を視覚的に確認できます。

### グラフの見方

- **ステップチャート（階段状の折れ線）**: 期間ごとの1日あたり点数を水平線で表示
  - **青色**: 期間Ⅰ（最も高い点数）
  - **緑色**: 期間Ⅱ
  - **オレンジ色**: 期間Ⅲ
- **縦の点線**: 期間の境界（日数が表示されます）
- **赤い縦線**: 入院日数を入力している場合、その日数の位置にマーカーが表示されます

### グラフ下部のサマリー

各期間のカードに以下が表示されます：
- 期間名と対象日数範囲
- 1日あたりの点数
- その期間の小計点数

入院日数を指定している場合は、合計点数と出来高日数の警告も表示されます。

---

## DPC比較機能

最大4つのDPCを並べて比較できます。

### 使い方

1. 比較したいDPCのチェックボックスにチェックを入れます
2. 画面下部に比較リストバーが表示されます
3. 2つ以上選択した状態で「比較」ボタンをクリック
4. 比較チャートと比較テーブルが表示されます

お気に入りに登録したDPCは、「履歴」パネルのお気に入りタブから「+比較」ボタンで比較リストに追加できます。

### 比較チャート

比較モーダルの上部に、全DPCの点数推移を1つのグラフ上に重ねて表示します。

- 各DPCは異なる色と線種（実線・破線・点線）で描画されるため、線が重なっても区別できます
- 各期間の境界にはドット（丸印）が配置されます
- 各期間の点数値がラベルとして表示されます
- 入院日数を入力している場合、赤い縦線でマーカーが表示されます

### 比較テーブルの見方

- 各行が比較項目（DPCコード、分類、手術、処置、点数など）
- DPCコードの横にはチャートと同じ色のドットが表示され、グラフとの対応がわかります
- 値が異なるセルは**黄色**で強調
- 数値項目（点数・期間）は**最大値が青**、**最小値が赤**で色分け
- 入院日数を入力している場合、最下行に**総点数**が表示されます

---

## お気に入り・検索履歴

よく使うDPCや検索条件を保存・再利用できます。

### お気に入り

- 検索結果の各DPCの左端にある **☆（星マーク）** をクリックすると、お気に入りに登録されます（★に変化）
- もう一度クリックすると解除されます
- お気に入りはブラウザの**localStorage**に保存されるため、ページを閉じても維持されます

### 検索履歴

- 検索を実行するたびに、検索条件が自動的に保存されます（最大20件）
- 同じ条件で再検索した場合は重複せず、最新の位置に移動します

### 履歴パネルの使い方

1. 検索パネルの「**履歴**」ボタンをクリック
2. 「履歴」タブと「お気に入り」タブを切り替えられます
3. **履歴タブ**: 検索条件をクリックすると、その条件で再検索されます
4. **お気に入りタブ**:
   - DPCコードをクリックすると詳細モーダルが開きます
   - 「**+比較**」ボタンで比較リストに追加できます
   - 「✕」ボタンでお気に入りから削除できます

### 保存に関する注意事項

- 履歴・お気に入りは**ブラウザごと**に保存されます（他のユーザーに共有されません）
- ブラウザの**キャッシュクリア**を行うと削除されます
- **シークレットモード（プライベートブラウジング）** ではブラウザを閉じると消えます

---

## 同一MDC内の類似分類比較

詳細モーダルの下部にある「**同一MDC内の類似分類**」セクションを展開すると、同じMDC（主要診断群）に属する他の分類を一覧で確認できます。

### 表示内容

各分類について以下の情報が表示されます：

| 項目 | 説明 |
|------|------|
| **分類コード** | 6桁の分類コード |
| **分類名** | 診断群分類の名称 |
| **DPC数** | その分類に含まれるDPCの数 |
| **手術区分数** | 手術の分岐パターン数 |
| **期間I点数範囲** | 期間Ⅰの最低〜最高点数 |
| **最大入院日数** | 期間Ⅲの最大日数 |

### 使い方

- 分類をクリックすると、その分類のICD-10コードで自動的に検索が実行されます
- 分類コードの数値が近い順に並んでいるため、隣接する分類を比較しやすくなっています
- 類似の病態で異なる分類が適用される可能性がある場合の確認に便利です

---

## ICD-10一覧

検索結果がある状態で「ICD-10一覧」ボタンをクリックすると、検索結果に含まれる全ての分類の対象ICD-10コードを一覧表示します。

- 上部の検索欄でコードや病名を絞り込み可能
- 分類数とコード数が表示されます

---

## ソート・フィルタ

### 並び替え

| モード | 説明 |
|--------|------|
| **総点数順** | 入院日数を入力している場合、総点数が高い順。未入力の場合は手術区分 → 処置等の優先度順 |
| **DPC期間が長い順** | 期間Ⅲの日数が長い順 |

### MDCフィルタ

MDC（主要診断群）で検索結果を絞り込みます。

| MDC | 分類名 |
|-----|--------|
| 01 | 神経系 |
| 02 | 眼科系 |
| 03 | 耳鼻咽喉科系 |
| 04 | 呼吸器系 |
| 05 | 循環器系 |
| 06 | 消化器系 |
| 07 | 筋骨格系 |
| 08 | 皮膚・皮下組織 |
| 09 | 乳房 |
| 10 | 内分泌・代謝 |
| 11 | 腎・泌尿器 |
| 12 | 女性生殖器・産褥 |
| 13 | 血液・免疫 |
| 14 | 新生児・先天性 |
| 15 | 小児 |
| 16 | 外傷・中毒 |
| 17 | 精神 |
| 18 | その他 |

---

## DPCコーディングの基本的な流れ

本ツールを使ったDPCコーディングの一般的な手順です。

### ステップ1: 傷病名で分類を特定

「疾患名 / ICD-10」欄に主傷病名またはICD-10コードを入力し、対象の診断群分類を特定します。

### ステップ2: 手術を選択

手術がある場合は「手術 Kコード」欄にKコードを入力して、手術区分を絞り込みます。手術なしの場合はこの欄は空欄のまま検索します。

### ステップ3: 処置等を確認

検索結果の「他に評価される項目」パネルを確認し、実施した処置等があれば選択します。

- **処置等1**: 人工呼吸器、中心静脈圧測定など
- **処置等2**: 人工腎臓、SPECT、中心静脈注射、薬剤など

複数の処置に該当する場合は、**最も優先度の高いもの**が自動的に適用されます。ドリルダウンで項目を選択すると、それより高い優先度の項目のみが表示されるため、優先度の高い方から順に確認できます。

### ステップ4: 副傷病・重症度を確認

詳細モーダルで副傷病の対象ICDや重症度分岐を確認し、該当する条件を特定します。

### ステップ5: 類似分類の確認

詳細モーダルの「同一MDC内の類似分類」セクションを確認し、より適切な分類がないかを検討します。

### ステップ6: 点数を確認

入院日数を入力して総点数を確認します。「点数推移グラフ」で期間別の点数変化を視覚的に確認できます。必要に応じて比較機能で複数のDPCを比較チャート付きで比べることができます。

### ステップ7: お気に入りに保存

よく使うDPCは★マークで保存しておくと、次回以降すぐにアクセスできます。

---

## 用語集

| 用語 | 説明 |
|------|------|
| **DPC** | 診断群分類（Diagnosis Procedure Combination）。入院医療の包括評価に用いる分類 |
| **DPCコード** | 14桁の分類コード。MDC + 疾患分類 + 条件 + 手術 + 処置等1 + 処置等2 + 副傷病 で構成 |
| **MDC** | 主要診断群（Major Diagnostic Category）。上位2桁で表される大分類（01〜18） |
| **ICD-10** | 国際疾病分類第10版。傷病名の国際的なコード体系 |
| **Kコード** | 診療報酬の手術区分コード（K001〜K920等） |
| **包括評価** | DPCに基づき1日あたりの定額点数で算定する方式 |
| **出来高算定** | 実施した医療行為ごとに個別に点数を算定する方式 |
| **期間Ⅰ/Ⅱ/Ⅲ** | DPCの入院期間区分。期間Ⅰが最も高い点数、期間Ⅲを超えると出来高算定 |
| **処置等1** | 手術・処置等1。人工呼吸器や中心静脈圧測定など、主に処置に関する分岐 |
| **処置等2** | 手術・処置等2。薬剤投与や特定の検査など、主に薬剤・検査に関する分岐 |
| **定義副傷病** | DPCの分岐に影響する合併症・併存症 |
| **重症度** | 一部の分類で設定されている重症度等による分岐（JCSやBurn Indexなど） |
| **corrVal（優先度）** | 処置等の分岐における優先度。数値が大きいほど優先。複数該当時は最も高い値が適用 |
| **出来高算定手術** | 包括評価の対象外となる手術。DPC制度上、出来高方式で算定される |

---

## 開発者向け情報

### 技術スタック

- **フロントエンド**: React 18 + Vite 5
- **デプロイ**: GitHub Pages（単一HTMLファイルにビルド）
- **データ保存**: localStorage（お気に入り・検索履歴）
- **データ**: 令和6年度 DPC電子点数表をJSON形式に変換して同梱

### ローカル開発

```bash
npm install    # 依存パッケージのインストール
npm run dev    # 開発サーバー起動（http://localhost:5173）
npm run build  # 本番ビルド（dist/index.html に出力）
```

### ファイル構成

| ファイル | 役割 |
|---------|------|
| `src/data.js` | DPC電子点数表データ（JSON） |
| `src/utils.js` | 検索・計算ロジック |
| `src/storage.js` | localStorage管理（お気に入り・検索履歴） |
| `src/styles.js` | フォント定義 |
| `src/components/DPCTool.jsx` | メイン画面（検索・結果一覧） |
| `src/components/Detail.jsx` | 詳細モーダル |
| `src/components/SimChart.jsx` | 点数推移グラフ |
| `src/components/CompareModal.jsx` | DPC比較モーダル（比較チャート付き） |
| `src/components/HistoryPanel.jsx` | 検索履歴・お気に入りパネル |
| `src/components/SimilarCls.jsx` | 同一MDC内の類似分類一覧 |
| `src/components/DrillDown.jsx` | ドリルダウン絞り込みパネル |
| `src/components/AC.jsx` | オートコンプリート入力欄 |
| `src/components/IcdPanel.jsx` | ICD-10一覧モーダル |

### データ構造（src/data.js）

| キー | 内容 |
|------|------|
| `D.dpc` | DPCコード → [MDC2桁, 分類4桁, 出来高フラグ, 手術区分, 処置1, 処置2, 副傷病, 期間Ⅰ日数, Ⅱ日数, Ⅲ日数, Ⅰ点数, Ⅱ点数, Ⅲ点数] |
| `D.cls` | 分類コード6桁 → 分類名 |
| `D.icd` | 分類コード → 対象ICD-10コードの配列 |
| `D.icn` | ICD-10コード → 病名 |
| `D.si` | 分類 → 手術区分 → 手術リストインデックス |
| `D.sl` | 手術リストインデックス → Kコードの配列 |
| `D.cn` | コード → 名称（手術・処置・薬剤共通） |
| `D.br` | 分類 → 手術区分 → 分岐種別（"1":処置1, "2":処置2, "s":副傷病） |
| `D.p1` | 分類 → 優先度 → 処置等1コードの配列 |
| `D.p2` | 分類 → 優先度 → 処置等2コードの配列 |
| `D.sd` | 分類 → 副傷病値 → ICD-10コードの配列 |
| `D.sv` | 分類 → 重症度定義（name, 値→ラベル） |
| `D.pt` | 分類 → 条件コード → 条件ラベル |
| `D.dk` | 出来高算定手術Kコード → 1 |
| `D.da` | 薬剤コード → 別名（商品名）の配列 |
| `D.lb` | 分類 → 分岐種別 → 値 → ラベル |

### 検証

```bash
node _verify.mjs   # 包括テスト実行
```

---

*令和6年度 DPC電子点数表に基づく*
